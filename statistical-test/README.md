# 統計的仮説検定
基本的には、statistical-estimationを参照。

## 母平均検定
2群の場合は、その差分 $\mu_1-\mu_2$ について検定するもとのする。

| 方法 | 条件 | 備考 |
| --- | --- | --- |
| Student's t検定 | 母集団が正規分布 & 母分散が未知 & 母分散が等しい(2標本時) |
| Z検定 | 母集団が正規分布 & 母分散が既知 & 母分散が等しい(2標本時) |
| Welch's t検定 | 2標本時、母集団が正規分布 & 母分散が未知 |
| Wilcoxon signrank test | 2標本時、対応がある場合 |
| Wilcoxson ranksum test | 2標本時、対応がない場合 |

### rank sum test
2つの群A,B (要素数 $n_A, n_B$ ) について、群Aのほうが群Bより小さいとする片側検定を考える。A,Bの全ての要素を並べ替えて、小さい方から順位を与える。
群ごとにその順位の平均を検定統計量 $W_A, W_B$ 、 値を $w_A, w_B$ として、 $P(W_A \leq w_A)$ がP値となる。

### signrank test

## 母分散検定
| 方法 | 条件 | 備考 |
| --- | --- | --- | 
| カイ二乗分布を用いた検定 | 母集団が正規分布 | | 
| F検定 | 母集団が正規分布 | 2群の等分散性の検定、等しくないとき棄却される|

## 正規性の検定
正規分布か検定する
| 方法 | 条件 | 備考 |
| --- | --- | --- | 
| Shapiro-Wilk 検定 |  |　|
|Kolmogorov-Smirnov 検定 | | 

## 適合度検定
観測した分布が、何らかの理論分布と同一かを検定する。ここでは、ピアソンのカイ二乗検定を取り上げる。

ある事象Aについて、 $A_i (1\leq i \leq n)$ と定める。以下の用語をまず定義する。
- 観測度数 $n_i$ : 観測された回数
- 理論確率 $p_i$ : 理論的に発生する確率
- 理論度数 $m_i = n * p_i$

このとき、以下が成り立つ。

$$
\sum_i \frac{(n_i - m_i)^2}{m_i} \sim \chi^2(n-1)
$$


(備考) 帰無仮説が正しい場合に、検定統計量が漸近的にカイ二乗分布に従うような統計的検定法をカイ二乗検定と呼ぶ。


##分割表と独立性に関する検定
###ピアソンのカイ二乗検定

A, B2つの事象について、 $A_i (1\leq i \leq a)$, $B_j (1\leq j \leq n)$　とし、$A_i$ かつ $B_i$ の観測度数を $n_{ij}$ 、総回数を $n (=\sum_{ij} n_{ij})$ とする。
理論度数を以下で定義する。

$$
m_{ij} = nP(A=A_i)P(B=B_j)
$$

この値を用いて、以下が定まる。

$$
U = \sum_{ij} \frac{(n_{ij}-m_{ij})^2}{m_{ij}} \sim \chi^2((a-1)(b-1))
$$

### 尤度比検定

### Fisherの正確確率検定


## 1要因の分散分析
3群以上の分散について分析する。
https://qiita.com/yoshida3/items/23583bf034c31d587be3

要因Aについて、 $i \in [1, a]$ の群があり、各群には $n_i$ の要素があり、全体で $N$ サンプルあるとする。

$\epsilon \sim (0, \sigma^2)$ として、

$$
y_{ij} = \mu + \alpha_i + \epsilon_{ij}
$$

で表される $\alpha_i$ が全て等しく0であること、を帰無仮説として考える。
この検定に、分散分析を用いる。
手順としては、以下の流れとなる

- (1) 分散分析で有意差があるか確かめる
- (2) 各 $A_i$ について、推定する。

### 分散分析

このとき、まず以下の変数を定義する。
- 平均 $\bar{y} = \frac{1}{aN}\sum_{i,j} y_{ij}$
- 水準平均 $\bar{y_{A_i}} = \frac{1}{n_i}\sum_j(y_{A_ij}) $

ここで、次のように誤差を定義する。

|名称 | 値 | 自由度 ${\phi}$ |
| -- | -- | -- | 
|総平方和 $S_T$ | $\sum_{ij} (y_{ij}-\bar{y})^2$ | $aN-1$ | 
|水準平方和 $S_A$ | $\sum_i n_i(\bar{y_{A_i}} - \bar{y})^2 $ | $a-1$ |
|誤差平方和 $S_E$ | $\sum_{ij} (y_{ij} - \bar{y_{A_i}})^2$ | $\sum_i(n_i-1)$ |

水準平方和は、要因aについて異なる群間での差を表現し、誤差平方和は、群内での誤差を全群で合計したものである。

これらを用いて、以下のような分散分析表を作成できる。

| S | 自由度 | 変動 | F値 |
| --- | --- | --- | --- |
| $S_A$ | $\phi_A$ | $V_A = S_A / \phi_A$ | $V_A / V_E \sim F(\phi_A, \phi_E)$  |
| $S_E$ | $\phi_E$ | $V_E = S_E / \phi_E$ |   |

このF値によって、帰無仮説を検証する。

### 個別の検定
$A_i$ における、 $\mu + \alpha_i$ の95%信頼区間は、t分布に従い、以下の通りとなる。

$$
\bar{y}_{A_i} \pm t_{0.025}(\phi_E) \sqrt{V_E/n_i}
$$

## 2要因の分散分析
要因A, Bについて、 $i \in [1, a]$ , $j \in [1, b]$ の群があり、それぞれ $k \in [1, n]$ サンプルあるとする。

(注: 1要因と同じく、各条件ごとに値が違う場合もあるが、添え字が面倒なので、全て $n$ で統一する)

ここで、次のように誤差を定義する。

|名称 | 値 | 自由度 ${\phi}$ |
| -- | -- | -- | 
|総平方和 $S_T$ | $\sum_{ijk} (y_{ijk}-\bar{y})^2$ | $an-1$ | 
|要因Aの水準平方和 $S_A$ | $bn\sum_i (\bar{y_{A_i}} - \bar{y})^2 $ | $a-1$ |
|要因Bの水準平方和 $S_B$ | $an\sum_j (\bar{y_{B_j}} - \bar{y})^2 $ | $b-1$ |
|AxBの平方和 $S_{AB}$ | $n\sum_{ij} (\bar{y_{A_i, B_j}} - \bar{y_{A_i}} - \bar{y_{B_j}} + \bar{y})^2$ | $(a-1)(b-1)$ |
|誤差平方和 $S_E$ | $\sum_{ijk} (y_{ijk} - \bar{y}_{A_i, B_j})^2$ | $abn-1$ |

水準平方和は、要因aについて異なる群間での差を表現し、誤差平方和は、群内での誤差を全群で合計したものである。

これらを用いて、以下のような分散分析表を作成できる。

| S | 自由度 | 変動 | F値 |
| --- | --- | --- | --- |
| $S_A$ | $\phi_A$ | $V_A = S_A / \phi_A$ | $V_A / V_E \sim F(\phi_A, \phi_E)$  |
| $S_B$ | $\phi_B$ | $V_B = S_B / \phi_B$ | $V_B / V_E \sim F(\phi_B, \phi_E)$  |
| $S_{AB}$ | $\phi_{AB}$ | $V_{AB} = S_{AB} / \phi_{AB}$ | $V_{AB} / V_E \sim F(\phi_{AB}, \phi_E)$  |
| $S_E$ | $\phi_E$ | $V_E = S_E / \phi_E$ |   |

あとは、1要因に同じく。
